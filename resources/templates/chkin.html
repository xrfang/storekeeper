{{define "body"}} {{template "header"}}
<nav class="navbar navbar-expand navbar-dark bg-dark">
  <a class="navbar-brand" href="#"><img src="/imgs/nav_title.png"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMenu">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarMenu">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/chkout">出库</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="#">入库</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link" href="#" data-toggle="dropdown">其他</a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/sku"><i class="fas fa-leaf"></i>&nbsp;药材管理</a>
          <a class="dropdown-item" href="/invchk"><i class="fas fa-tasks"></i>&nbsp;盘点</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/users"><i class="fas fa-user-cog"></i>&nbsp;用户管理</a>
        </div>
      </li>      
    </ul>
    <ul class="navbar-nav ml-auto">
      <a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt"></i></a>
    </ul>
  </div>
</nav>
<div class="container" style="padding-top:1em">
  <p style="margin-top:1rem;font-weight:bold">当前进货单概况</p>
  <p style="font-family: 'Courier New', Courier, monospace">
  {{range $stat, $bill := index . "bills" }}
    {{if eq $stat 0}}
    未完成：<a href="javascript:listBills('0')">{{len $bill}}张</a> &nbsp;
    {{else}}
    已完成：<a href="javascript:listBills('1')">{{len $bill}}张</a> &nbsp;
    {{end}}  
  {{end}}
  </p>
  <p>
    {{if gt (len (index . "bills")) 0}}
    请点击上面的连接获取各状态进货单详情，或
    {{else}}
    未完成：0张 &nbsp; 已完成：0张 &nbsp;
    <br><br>
    {{end}}<a href="/chkin/">新建进货单</a>
  </p>
  <p id="blist"></p>
</div>
<script>
var data = {{.}}
function un(id) {
  for (i = 0; i < data.Users.length; i++) {
    if (data.Users[i].id == id) return data.Users[i].name
  }
  return `user#${id}`
}
function listBills(status) {
  var bs = data.bills[status]
  var us = data.users
  var st = ""
  switch(status) {
  case '0':
    st = "未完成"
    break
  default:
    st = "已完成"
  }
  $('#blist').text("")
  $('#blist').append(`<p style="margin-top:1rem;margin-bottom:0.6rem;font-weight:bold">${bs.length}张${st}</p>`)
  $.each(bs, function(_, b) {
    var item = `<div style="margin-top:0.4rem;font-family:'Courier New',Courier,monospace">
      <a href="/chkin/${b.id}">[${b.updated.substring(0, 10)}] ${b.count}种药材`
    if (typeof(b.cost) != 'undefined' && b.cost > 0) item += `，总价${b.cost}元`
    if (typeof(b.memo) != 'undefined' && b.memo.length > 0) item+= ` (${b.memo})`
    item += `</a></div>`
    $('#blist').append(item)
  })
}
</script>
{{template "footer"}} {{end}}